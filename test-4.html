<!DOCTYPE html>
<html lang="en">

<body>
  <!-- Include the Shaka Player js and css. -->
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/shaka-player/4.5.0/shaka-player.compiled.debug.js"></script>

  <!-- Here is the video element that we will connect the Shaka Player to. -->
  <video id="drm-demo" style="width: 100%" autoplay muted></video>

  <script>
    // These values are pulled from the Axinom GitHub page above.
    const axManifestUri = 'https://f177dfb80b7349c8e418704e.blob.core.windows.net/video-output/face/manifest.mpd';
    const axLicenseServer = "https://drm-widevine-licensing.axprod.net/AcquireLicense";
    const axLicenseHeader = "X-AxDRM-Message";
    const axLicenseToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ2ZXJzaW9uIjoxLCJjb21fa2V5X2lkIjoiMjFiYmEzZjEtYmNlYi00ZDVkLWE0ZjgtYjFhMzAxMTZiYzQzIiwibWVzc2FnZSI6eyJ0eXBlIjoiZW50aXRsZW1lbnRfbWVzc2FnZSIsInZlcnNpb24iOjIsImxpY2Vuc2UiOnsic3RhcnRfZGF0ZXRpbWUiOiIyMDI0LTA3LTA2VDE4OjQ4OjE2LjI5OFoiLCJleHBpcmF0aW9uX2RhdGV0aW1lIjoiMjAyNC0wNy0wOFQxODo0ODoxNi4yOThaIiwiYWxsb3dfcGVyc2lzdGVuY2UiOnRydWV9LCJjb250ZW50X2tleXNfc291cmNlIjp7ImlubGluZSI6W3siaWQiOiJkNTRmZjc2NS1kZDBjLTRjZTItOTI3NC1jYWUwMzc2NTdhZjUiLCJ1c2FnZV9wb2xpY3kiOiJQb2xpY3kgQSJ9XX0sImNvbnRlbnRfa2V5X3VzYWdlX3BvbGljaWVzIjpbeyJuYW1lIjoiUG9saWN5IEEiLCJwbGF5cmVhZHkiOnsibWluX2RldmljZV9zZWN1cml0eV9sZXZlbCI6MTUwLCJwbGF5X2VuYWJsZXJzIjpbIjc4NjYyN0Q4LUMyQTYtNDRCRS04Rjg4LTA4QUUyNTVCMDFBNyJdfX1dfSwiYmVnaW5fZGF0ZSI6IjIwMjQtMDctMDZUMTg6NDg6MTYuMjk4WiIsImV4cGlyYXRpb25fZGF0ZSI6IjIwMjQtMDctMDhUMTg6NDg6MTYuMjk4WiJ9.yp8m2UIg2KmWEgq_Va3PLKWFxnwDPwVW0qWgvE3WeqA";

    function initApp() {
      // Install built-in polyfills to patch browser incompatibilities.
      shaka.polyfill.installAll();

      // Check to see if the browser supports the basic APIs Shaka needs.
      if (shaka.Player.isBrowserSupported()) {
        // Everything looks good!
        initPlayer();
      } else {
        // This browser does not have the minimum set of APIs we need.
        console.error('Browser not supported!');
      }
    }

    async function initPlayer() {
      // Create a Player instance.
      const video = document.getElementById('drm-demo');
      const player = new shaka.Player(video);

      // Listen for error events.
      player.addEventListener('error', onErrorEvent);

      // Set the widevine license server url.
      player.configure({
        drm: {
          servers: {
            'com.widevine.alpha': axLicenseServer,
          }
          // clearKeys: {
          //   // 'key-id-in-hex': 'key-in-hex',
          //   'deadbeefdeadbeefdeadbeefdeadbeef': '18675309186753091867530918675309',
          //   '02030507011013017019023029031037': '03050701302303204201080425098033'
          // }
        }
      });

      // Add the license token to the license request.
      player.getNetworkingEngine().registerRequestFilter(function (type, request) {
        // Only add headers to license requests:
        if (type == shaka.net.NetworkingEngine.RequestType.LICENSE) {
          // This is the specific header name and value the server wants:
          request.headers[axLicenseHeader] = axLicenseToken;
        }
      });

      // Try to load a manifest.
      // This is an asynchronous process.
      try {
        await player.load(axManifestUri);
        // This runs if the asynchronous load is successful.
        console.log('The video has now been loaded!');
      } catch (e) {
        // onError is executed if the asynchronous load fails.
        onError(e);
      }
    }

    function onErrorEvent(event) {
      // Extract the shaka.util.Error object from the event.
      onError(event.detail);
    }

    function onError(error) {
      // Log the error.
      console.error('Error code', error.code, 'object', error);
    }

    document.addEventListener('DOMContentLoaded', initApp);
  </script>

</body>

</html>